{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useState, useContext } from 'react';\n\nconst CONFIGLY_SERVER_URL = \"https://api.config.ly/api/v1/value\";\n\ninterface props {\n    prop: string,\n    render?: (value: string) => JSX.Element,\n    default?: any\n}\n\nfunction loadConfiglyData(key: string, apiKey: string | null, onComplete: (data: string) => any) {\n    const headers = new Headers();\n    headers.append('Authorization', 'Basic ' + btoa(`${apiKey}:`));\n    fetch(`${CONFIGLY_SERVER_URL}?keys[]=${key}`, {method: 'GET', headers})\n      .then(res => res.json())\n      .then((result) => onComplete(result.data[key]?.value), (error) => {console.log(error)});\n}\n\nfunction useConfigly() {\n    const config = useContext(ConfiglyContext);\n    const [value, setValue] = useState(null);\n    const [requestInProgress, setRequestInProgress] = useState(false);\n    const [loaded, setLoaded] = useState(false);\n\n    const onComplete = (data: any) => {\n        setLoaded(true);\n        setRequestInProgress(false);\n        setValue(data);\n    }\n    const loadConfig = (key: string) => {\n        if (!requestInProgress && !loaded) {\n            loadConfiglyData(key, config.apiKey, onComplete);\n            setRequestInProgress(true);\n        }\n    }\n    return { loadConfig, value, requestInProgress, loaded };\n}\n\nfunction BaseConfiglyComponent(props: props) {\n    const { loadConfig, value, loaded } = useConfigly();\n    const emptyValue = value === null || value === undefined;\n\n    loadConfig(props.prop);\n\n    if (!loaded && !props.default) {\n        return (<React.Fragment>LOADING...</React.Fragment>)\n    } else if ((!loaded || emptyValue) && props.default && props.render) {\n        return (props.render(props.default));\n    } else if (loaded && props.render && !emptyValue) {\n        return(props.render(value || ''));\n    } else {\n        return (<React.Fragment />);\n    }\n}\n\nfunction ConfiglyComponent(props: props) {\n    return (<BaseConfiglyComponent prop={props.prop} render={props.render} default={props.default} />);\n}\n\nfunction ConfiglyText(props: props) {\n    return (<BaseConfiglyComponent prop={props.prop} render={(value: string) => { return (<span>{value}</span>) }} default={props.default} />);\n}\n\nfunction ConfiglyDropdown(props: props) {\n    const renderDropdown =(value: string) => {\n        const options = Object.keys(value).map((key) =>\n            <option key={key} value={key}>{value[key]}</option>\n        );\n\n        return (<select>{options}</select>);\n    }\n    return (<BaseConfiglyComponent prop={props.prop} render={renderDropdown} default={props.default}/>);\n}\n\ninterface ConfiglyContextType {\n    apiKey: string | null\n}\n\nconst ConfiglyContext = React.createContext<ConfiglyContextType>({apiKey: null})\n\nexport {ConfiglyText, ConfiglyDropdown, ConfiglyContext, useConfigly, ConfiglyComponent as default};"],"names":["useContext","useState","React"],"mappings":"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"}